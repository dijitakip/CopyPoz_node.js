# MQL5 Master-Client Senkronizasyon ve Sembol Düzeltme Planı

Kullanıcının belirttiği sorunlar (eksik açılan pozisyonlar, kapanmayan "yetim" pozisyonlar ve sembol eşleşmesi) doğrultusunda aşağıdaki düzenlemeler yapılacaktır:

## 1. Sembol Eşleştirme ve Dönüştürme (Symbol Mapping)
**Sorun:** Mevcut kodda sembol dönüştürme fonksiyonları eksik veya devre dışı, bu da Master'dan gelen sinyallerin Client'ta doğru sembolle eşleşmesini engelliyor. Ayrıca "tek sembol" isteği için katı bir eşleştirme gerekiyor.
**Çözüm:**
*   `IsSameSymbol` ve `ConvertSymbol` fonksiyonları dosyanın sonuna eklenecek.
*   `ConvertSymbol` fonksiyonu, Input parametrelerindeki `MasterSymb` ve `ClientSymb` değerlerini **birinci öncelik** olarak kontrol edecek. Eğer Master'dan gelen sembol `MasterSymb` ile aynıysa, kesinlikle `ClientSymb` döndürülecek.
*   `CopyPosition` fonksiyonu, sabit `ClientSymb` yerine bu dinamik dönüştürme fonksiyonunu kullanacak şekilde güncellenecek.

## 2. Senkronizasyon ve "Yetim" Pozisyon Temizliği (Sync Cleanup)
**Sorun:** Mevcut senkronizasyon mantığı (`ProcessPositionsBroadcast`), sadece Master'dan gelen pozisyonları Client'a ekliyor/güncelliyor. Ancak Master'da kapanmış veya silinmiş pozisyonları Client tarafında tespit edip kapatmıyor.
**Çözüm:**
*   `ProcessPositionsBroadcast` fonksiyonuna **"Ters Kontrol" (Reverse Check)** mekanizması eklenecek.
*   **Mantık:**
    1.  Master'dan gelen tüm açık pozisyonların Ticket numaraları bir listede toplanacak.
    2.  Client tarafındaki tüm açık pozisyonlar taranacak.
    3.  Eğer bir Client pozisyonu bu bot tarafından açılmışsa (Magic Number/Yorum kontrolü) ve orijinal Master Ticket'ı yukarıdaki listede **YOKSA**, bu pozisyon "yetim" kabul edilip kapatılacak.

## 3. Hata Ayıklama ve İyileştirmeler
*   Pozisyon açılmama durumlarını daha iyi anlamak için `ProcessSingleMasterPosition` ve `CopyPosition` fonksiyonlarına ek loglamalar eklenecek.
*   Hatalı sembol veya işlem tipi durumlarında detaylı uyarı mesajları yazdırılacak.

Bu plan, Client botunun Master ile tam senkronize çalışmasını (açma, güncelleme VE kapatma) ve sembollerin kullanıcı isteğine göre doğru eşleşmesini sağlayacaktır.
